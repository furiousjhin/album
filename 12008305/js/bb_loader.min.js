"use strict";

function BBloader(t) {
    this.defStr = "sound_", this.htc = t, this.sound_list = {}, this.shift_list = [], this.shift_limit = 5, this.loading = !1
}
var boombox = window.boombox;
! function() {
    if (void 0 != boombox) {
        var t = navigator.userAgent,
            o = t.indexOf("ISW13HT") > -1,
            i = t.indexOf("Android") > -1;
        i && t.match(/Android [4-9]|Android [0-9][0-9]/) && t.match(/Chrome\/[5-9][0-9].|Chrome\/[0-9][0-9][0-9]/) && (i = !1);
        var s = {
            webaudio: {
                use: !1
            }
        };
        if (void 0 == window.sound_flag) {
            var l = new BBloader(o);
            window.bb_loader = l, boombox.onFocus = function() {}, boombox.onPageShow = function() {}, boombox.onVisibilityChange = function() {}, boombox.onBlur = function() {
                l.stop(null, !0)
            }, boombox.onPageHide = function() {
                l.stop(null, !0)
            }, boombox.setup(i ? s : null), boombox.isWebAudio() || boombox.isHTMLAudio() || !boombox.isHTMLVideo() || (o = !0), $("body").on("click", ".boombox_play", function(t) {
                var o = $(t.currentTarget).attr("id");
                return window.bb_loader.play(o), !1
            })
        }
    }
}(), BBloader.prototype.setList = function(t) {
    for (var o in t) {
        var i = t[o].id ? t[o].id : o,
            s = t[o].path ? t[o].path : t[o],
            l = t[o].start_call ? t[o].start_call : function() {},
            n = t[o].stop_call ? t[o].stop_call : function() {};
        this.sound_list[i] = {
            path: s,
            start_call: l,
            stop_call: n
        }
    }
}, BBloader.prototype.play = function(t) {
    if (!this.loading) {
        var o = this;
        if (void 0 != this.sound_list[t])
            if (void 0 == this.sound_list[t].player) {
                this.loading = !0;
                var i = {
                    src: [{
                        media: "audio/mp4",
                        path: this.sound_list[t].path
                    }]
                };
                boombox.load(this.defStr + t, i, this.htc, function(i, s) {
                    o.shift_list.push(t), o.sound_list[t].player = boombox.get(o.defStr + t), o.sound_list[t].player.onEnded = function() {
                        o.sound_list[t].stop_call()
                    }, o.stop(t), o.sound_list[t].player.play(), o.sound_list[t].start_call(), o.shiftDelete(), o.loading = !1
                })
            } else this.stop(t), this.sound_list[t].player.isPause() ? (this.sound_list[t].player.resume(), this.sound_list[t].start_call()) : this.sound_list[t].player.isStop() ? (this.sound_list[t].player.replay(), this.sound_list[t].start_call()) : (this.sound_list[t].player.pause(), this.sound_list[t].stop_call())
    }
}, BBloader.prototype.stop = function(t, o) {
    for (var i in this.sound_list)
        if (i !== t && this.sound_list[i].player) {
            if (this.sound_list[i].player.isPause()) continue;
            o ? this.sound_list[i].player.pause() : this.sound_list[i].player.stop(), this.sound_list[i].stop_call()
        }
}, BBloader.prototype.shiftDelete = function() {
    if (!(this.shift_list.length <= this.shift_limit)) {
        var t = this.shift_list.shift();
        boombox.remove(this.defStr + t), delete this.sound_list[t].player
    }
}, BBloader.prototype.listClear = function() {
    this.stop();
    for (var t in this.shift_list) boombox.get(this.defStr + t) && boombox.remove(this.defStr + t);
    delete this.shift_list, this.shift_list = [], delete this.sound_list, this.sound_list = {}
};
